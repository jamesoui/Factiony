[build]
publish = "dist"
command = "npx vite build"

[build.environment]
SECRETS_SCAN_SMART_DETECTION_OMIT_VALUES = "AIzaSyCnduNWsBXaMbDKgVB9mflpJIdPr7jceI0"

# IMPORTANT: exclude share/og routes from SPA fallback
[[redirects]]
from = "/share/review/*"
to = "/share/review/:splat"
status = 200
force = true

[[redirects]]
from = "/og/review/*"
to = "/og/review/:splat"
status = 200
force = true

# SPA fallback
[[redirects]]
from = "/*"
to = "/index.html"
status = 200

[[edge_functions]]
function = "share-review"
path = "/share/review/*"

[[edge_functions]]
function = "og-review"
path = "/og/review/*"
# -----------------------------
# Credit-saver: cache + bot hints
# -----------------------------

[[headers]]
  for = "/.netlify/functions/*"
  [headers.values]
    X-Robots-Tag = "noindex, nofollow"

# Assets build Vite (/dist/assets/*)
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Common image extensions anywhere (covers, OG, etc.)
[[headers]]
  for = "/*.png"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.jpg"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.jpeg"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.webp"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Pages jeux: cache 1 jour + tol√©rance 7 jours
[[headers]]
  for = "/game/*"
  [headers.values]
    Cache-Control = "public, max-age=86400, stale-while-revalidate=604800"
[[headers]]
  for = "/logo-factiony.png"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
[[edge_functions]]
function = "ai-reco"
path = "/api/ai-reco"
[[edge_functions]]
function = "ai-reco"
path = "/api/ai-reco/*"
